
<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<script src='file:///android_asset/app.js'></script>
<link href="boostrap/css/bootstrap1.css" rel="stylesheet">

    <link href="boostrap/css/bootstrap1.css" rel="stylesheet">
    <link href="boostrap/css/dat.css" rel="stylesheet">
    <link href="boostrap/css/date2.css" rel="stylesheet">

    
    <link href="boostrap/css/bootstrap2.css" rel="stylesheet">
    <link href="boostrap/css/bootstrap3.css" rel="stylesheet">
    <link href="boostrap/css/bootstrap4.css" rel="stylesheet">
    <link href="boostrap/css/bootstrap5.css" rel="stylesheet">
    <link href="boostrap/css/bootstrap6.css" rel="stylesheet">
    <link href="boostrap/css/bootstrap7.css" rel="stylesheet">
    <link href="boostrap/css/bootstrap8.css" rel="stylesheet">
    <link href="boostrap/css/swiper.min.css" rel="stylesheet">
    
    <link href="boostrap/fonts/glyphicons-halflings-regular.eot" rel="stylesheet">
    <link href="boostrap/fonts/glyphicons-halflings-regular.svg" rel="stylesheet">
    <link href="boostrap/fonts/glyphicons-halflings-regular.ttf" rel="stylesheet">
    <link href="boostrap/fonts/glyphicons-halflings-regular.woff" rel="stylesheet">
    <link href="boostrap/fonts/glyphicons-halflings-regular.woff2" rel="stylesheet">
    <script src="boostrap/js/swiper.min.js"></script>
    <script src="boostrap/js/jquery.js"></script>
    <script src="boostrap/js/date.js"></script>
    <script src="boostrap/js/date2.js"></script>
    <script src="boostrap/js/bootstrap.js" type="text/javascript" >
<script src="uploadFile.js"></script>


</head>
<style id="mystyle">
.Cinput{
height:40px;
width:100%;
}
.Cbutton
{
height:40px;
width:40px;
}
input{
width:100%;
height:40px;
border:none;
outline:none;
background:none;
font-weight:bold;
font-family:times;
padding-left:10px;
}

.upload-btn-wrapper {
  position: relative;
  overflow: hidden;
  display: inline-block;
  width:100%;
}

.upload-btn-wrapper input[type=file] {
  font-size: 100px;
  position: absolute;
  left: 0;
  top: 0;
  opacity: 0;
}
.radar {
  background: url(Img/raddar.png)
    no-repeat 50% 50%;
  width: 284px;
  height: 284px;
  position: relative;
  background-size: 284px 284px;
  position: absolute;
  left: 15%;
  top: 5%;
  margin-left: -284px / 2;
  margin-top: -284px / 2;
}

.radar .pointer {
  position: absolute;
  z-index: 1024;
  left: 10.5820106%;
  right: 10.5820106%;
  top: 10.5820106%;
  bottom: 50%;
  will-change: transform;
  transform-origin: 50% 100%;
  border-radius: 50% 50% 0 0 / 100% 100% 0 0;
  background-image: linear-gradient(
    135deg,
    rgba(5, 162, 185, 0.8) 0%,
    rgba(0, 0, 0, 0.02) 70%,
    rgba(0, 0, 0, 0) 100%
  );
  clip-path: polygon(
    100% 0,
    100% 10%,
      50% 100%,
    0 100%,
    0 0
  );

  animation: rotate360 1s infinite linear;
}

.radar .pointer:after {
  content: "";
  position: absolute;
  width: 50%;
  bottom: -1px;
  border-top: 2px solid rgba(0, 231, 244, 0.8);
  box-shadow: 0 0 3px rgba(0, 231, 244, 0.6);
  border-radius: 9px;
}

.shadow {
  position: absolute;
  left: 11%;
  top: 11%;
  right: 11%;
  bottom: 11%;
  margin: auto;
  border-radius: 9999px;
  box-shadow: 0 0 66px 6px #a51414;
  animation: shadow 1s infinite ease;
}

@keyframes rotate360 {
  0% {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(-360deg);
  }
}

@keyframes shadow {
  0% {
    opacity: 0;
  }
  50% {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}
.GB{
 position:absolute;
 z-index:100;
 color:white;
 font-size:10px;
 left:5%;
 top:5%;
}
.list
{
   position:absolute;
 z-index:100;
 color:white;
 left:2%;
 top:45%;
 width:96%;
 
}
.newList {
   max-height:350px;
   width:100%;
   overflow:scroll; 
}
.GH
{
 position:absolute;
 z-index:100;
 color:white;
 left:70%;
 top:2%;
}
</style>
<script>  


var themeColor = app.LoadText( "themeColor" );
var color = JSON.parse(themeColor);
var c1=color.c1;
var c2=color.c2;
var c3=color.c3;
var c4=color.c4;
var c5=color.c5;
var c6=color.c6;
var mytheme =app.LoadText( "mytheme" );
if (mytheme=="1")
{
document.getElementById("mystyle").innerHTML = document.getElementById("mystyle").innerHTML+" .fullBody{"
+"background: radial-gradient(ellipse farthest-corner at right bottom, #FEDB37 0%, #FDB931 8%, #9f7928 30%, #8A6E2F 40%, transparent 80%),"
+"radial-gradient(ellipse farthest-corner at left top, #FFFFFF 0%, #FFFFAC 8%, #D1B464 25%, #5d4a1f 62.5%, #5d4a1f 100%);"
+"height:100%;width:100%;margin:0;position:absolute;}"
+".mycontainer{"
+"background: radial-gradient(ellipse farthest-corner at right bottom, #FEDB37 0%, #FDB931 8%, #9f7928 30%, #8A6E2F 40%, transparent 80%) "
+", radial-gradient(ellipse farthest-corner at left top, #FFFFFF 0%, #FFFFAC 8%, #D1B464 25%, #5d4a1f 62.5%, #5d4a1f 100%);"
+"box-shadow:4px 4px 4px #"+c3+",-4px -4px 4px #"+c2+";"
+"font-weight:bold;}"
+".myinput{"
+"border:none;"
+"background:#"+c1+";"
+"outline:none;"
+"box-shadow:inset 5px 5px 5px #"+c3+", inset -5px -5px 5px #"+c2+";"
+"}"
+".mybutton{"
+"border:none;"
+"box-shadow:5px 5px 5px #"+c3+", -5px -5px 5px #"+c2+";"
+"outline:none;"
+"background: radial-gradient(ellipse farthest-corner at right bottom, #FEDB37 0%, #FDB931 8%, #9f7928 30%, #8A6E2F 40%, transparent 80%) "
+", radial-gradient(ellipse farthest-corner at left top, #FFFFFF 0%, #FFFFAC 8%, #D1B464 25%, #5d4a1f 62.5%, #5d4a1f 100%);"
+"font-weight:bold;font-family:times;}"
+".mybutton:hover{"
+"box-shadow:1px 1px 5px #"+c3+",  -1px -1px 5px #"+c2+";"
+"}"
+".FAA{color:#"+app.LoadText("fontA")+";}"
+".FB{color:#"+app.LoadText("fontB")+";}"
+".FC{color:#"+app.LoadText("fontC")+";}";
var size=app.LoadText("size").split(",");
for (i = 0; i < size.length; i++) {
document.getElementById("mystyle").innerHTML = document.getElementById("mystyle").innerHTML+" .F"+size[i]+"{font-size:"+size[i]+"px;} ";
}
}
else
{
document.getElementById("mystyle").innerHTML = document.getElementById("mystyle").innerHTML+" body{"
+"background:#"+c1+";"
+"}"
+".mycontainer{"
+"background:#"+c1+";"
+"box-shadow:4px 4px 4px #"+c3+",-4px -4px 4px #"+c2+";"
+"}"
+".myinput{"
+"border:none;"
+"background:#E6E6E6;"
+"outline:none;"
+"box-shadow:inset 5px 5px 5px #"+c3+", inset -5px -5px 5px #"+c2+";"
+"}"
+".mytext{text-shadow: 2px 2px 2px #"+c3+", -2px -2px 2px #"+c2+";}"
+".mytext2{text-shadow: 1px 1px 1px #"+c3+", -1px -1px 1px #"+c2+";}"
+".mybutton{"
+"border:none;"
+"box-shadow:5px 5px 5px #"+c3+", -5px -5px 5px #"+c2+";"
+"outline:none;"
+"background:#"+c1+"; " 
+"}"
+".mybutton:hover{"
+"box-shadow:1px 1px 5px #"+c3+",  -1px -1px 5px #"+c2+";"
+"}"
+".FAA{color:#"+app.LoadText("fontA")+";}"
+".FB{color:#"+app.LoadText("fontB")+";}"
+".FC{color:#"+app.LoadText("fontC")+";}";
var size=app.LoadText("size").split(",");
for (i = 0; i < size.length; i++) {
document.getElementById("mystyle").innerHTML = document.getElementById("mystyle").innerHTML+" .F"+size[i]+"{font-size:"+size[i]+"px;} ";
}
}
</script>

<body style="font-size:100%;">
<div class="GH">
	<button type="button" class="mybutton" style="width:100%;background-color:white;color:black;height:40px;font-weight:bold;font-size:20px;" id ="RC" onclick="records();" >My Records</button>
	</div>
	<div class="GB" style="color:red;"id="GA">
	</div>
	
	
</div><div class="radar">
  <div id="PO" class="pointer"></div>
  <div class="shadow"></div>
</div>
<div class="list">

    
<div style="text-align:center;color:black;font-weight:bold;font-size:20px;font-family:Times;">Nearby Project List</div>
<hr>
<div id="list2" class="newList">






</div>
</div>


<script>
var url=app.LoadText( "url" );

 var  rec = JSON.parse(app.LoadText( "userDetails" ));
       var    id=rec.id;
       var    Role=rec.role;
       var    User=rec.user;
       var   token=rec.token;
       var company =rec.company;
       var   ustatus ="";
       var uid = app.LoadText( "uid" );
       var projectarray="";
       var calculatedAge="";
       var projectdata ="";

player = app.CreateMediaPlayer();
    	player.SetFile( "Img/beep.mp3" );
  
  if (Role=="Employee")
  {
  app.SaveText("Change","empindex.html");
  }
  else
  {
  app.SaveText("Change","index.html");
  }
  function records()
  {
  app.Execute("record();");   
  }

 function getdata()
 {
 
// app.Execute("loader2(1);");   
	var 	req3=new XMLHttpRequest();
	req3.open("GET",app.LoadText( "url" )+"projectloc.php?id="+id+"&user="+User+"&token="+token,true);
		req3.onreadystatechange=function(){
if(	req3.readyState==4 && 	req3.status==200){if(	req3.responseText=="ufFygf")
{  

}else{

 if (req3.responseText.trim()==1)
 {
 app.Alert( "error please relogin" );
     app.Execute("loader2(4);");   
   app.SaveText("msg",'{"color":"red","msg":"Error"}');
 }
 else if(req3.responseText.trim()==2)
 {
  app.Alert( "User is blocked" );
       app.Execute("loader2(4);");   
   app.SaveText("msg",'{"color":"red","msg":"User is blocked"}');
 }
 else if(req3.responseText.trim()==3)
 {
       app.Execute("loader2(4);");   
   app.SaveText("msg",'{"color":"red","msg":"Permission denied"}');
 }
 else
 {

    projectdata =req3.responseText.trim();
 
 }
}}}
	req3.send();
}
getdata();

	if(app.IsLocationEnabled("gps")=="false")
	{
	app.Alert( "Please turn on GPS location " )
	}
	
	setTimeout(function()
	{
	loc = app.CreateLocator( "GPS,Network" );
	loc.SetOnChange( loc_OnChange ); 
	loc.SetRate( 4 ); //10 seconds.
	loc.Start();


	
	}, 2000);
	
	
var Count=0;	
var cap =0;
var b=1;
function loc_OnChange( data )  
{
if(b==1)
{
    Count=Count+1;
    var mydata="";
     mydata='<span style="color:red;">Finding ( '+Count+' ) ....</span>';      
     if(Count==10)
     {
         document.getElementById("GA").innerHTML="";
     }
    document.getElementById("GA").innerHTML=document.getElementById("GA").innerHTML+'<p>LT '+data.latitude+' , LN '+data.longitude+' , SP '+data.speed+' , AC '+data.accuracy+' , AL '+data.altitude+'   '+mydata+'</p>';
	document.getElementById("list2").innerHTML="";
	var Clat=data.latitude;
	var Clon=data.longitude;
	var btns2 = projectdata.split("@");
	  for(var i = 0; i < btns2.length ;  i++)
  {
     if (btns2[i].length>1)
      {
var  rec = JSON.parse(btns2[i]);
var  pid =rec.id;
var  SiteLat=rec.lat;
var  SiteLon =rec.lon;
var  SiteName=rec.name;
var  accuraccy=rec.accuracy;
var starttime =rec.starttime;
var start   =rec.start;
var endtime  =rec.endtime;
var end   =rec.end;
var color1 ="green";
var dis1 ="disabled";

if(start=="true")
{
var color1 ="green";
var dis1 ="disabled";
}
else
{
var color1 ="red";
var dis1 ="";
var color2 ="red";
var dis2 ="";
}

var color2 ="green";
var dis2 ="disabled";
if(end=="true")
{
if(endtime.length==0)
{
var color2 ="red";
var dis2 ="disabled";
}
else
{
var color2 ="green";
var dis2 ="disabled";
}
}
else
{
var color2 ="red";
var dis2 ="";
}
	var text1 ="";
	if(color1=="green")
	{
	text1 ="Started";
	}
	else
	{
	text1 ="Start";
	}
		var text2="";
	if(color2=="green")
	{
	text2 ="Ended";
	}
	else
	{
	text2 ="End";
	}
	           var R = 6371; // km
      var dLat = toRad(SiteLat-Clat);
      var dLon = toRad(SiteLon-Clon);
      var lat1 = toRad(Clat);
      var lat2 = toRad(SiteLat);

      var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2); 
      var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
      var d = R * c*1000;

if (d<accuraccy){
if(b==1)
{
player.SeekTo( 0 );
	player.Play();	
	b=0;
	}
document.getElementById("list2").innerHTML=document.getElementById("list2").innerHTML+'<input type="hidden" value="'+d+'" id="accu'+pid+'"><table style="background-color:#be4dff;width:94%;margin:3%;font-weight:bold;font-family:times;color:black;" class="mycontainer">'
+'<tr style="height:35px;">'
+'<td colspan="4" style="text-align:center;"class="F16" >'+SiteName+'</td>'
+'</tr>'
+'<tr class="F14" style="height:35px;">'
+'<td>Start Time</td><td id="start'+pid+'">'+starttime+'</td><td>End Time</td><td id="end'+pid+'">'+endtime+'</td>'
+'</tr>'
+'<tr>'
+'<td colspan="2" style="width:48%;"><button id="startb'+pid+'" style="width:95%;height:35px;background-color:'+color1+';" onclick="start('+pid+')" class="mybutton" '+dis1+'>'+text1+'</button></td>'
+'<td colspan="2"><button id="endb'+pid+'"style="width:95%;height:35px;background-color:'+color2+';" onclick="end('+pid+')"  class="mybutton" '+dis2+' >'+text2+'</button></td>'
+'</tr>'
+'</table>'
}

}}
}}
        function toRad(Value) 
        {
        return Value * Math.PI / 180;
        }

        
	function start(z)
	{
	var accu =document.getElementById("accu"+z).value;
	 app.Execute("loader2(1);");   
	var 	req4=new XMLHttpRequest();
	req4.open("GET",app.LoadText( "url" )+"addonline.php?id="+id+"&user="+User+"&device="+app.GetModel()+"&accuracy="+accu+"&type=start&pid="+z+"&token="+token,true);
		req4.onreadystatechange=function(){
if(	req4.readyState==4 && 	req4.status==200){if(	req4.responseText=="ufFygf")
{  

}else{

 if (req4.responseText.trim()==1)
 {
 app.Alert( "error please relogin" );
     app.Execute("loader2(4);");   
   app.SaveText("msg",'{"color":"red","msg":"Error"}');
 }
 else if(req4.responseText.trim()==2)
 {
  app.Alert( "User is blocked" );
       app.Execute("loader2(4);");   
   app.SaveText("msg",'{"color":"red","msg":"User is blocked"}');
 }
 else if(req4.responseText.trim()==5)
 {
       app.Execute("loader2(4);");   
   app.SaveText("msg",'{"color":"red","msg":"Already Started"}');
   app.Alert( "Already started" )
 }
 else
 {
 app.Alert("Seccessfully Submited");
 app.Execute("loader2(4);");   
   app.SaveText("msg",'{"color":"green","msg":"Seccessfully submited"}');
  	        var today = new Date();
var mymonth =today.getMonth();

var hour = today.getHours();
var minite ="";
if(today.getMinutes().length==1)
{
minite ="0"+today.getMinutes();
}
else
{
minite =""+today.getMinutes();
}
	document.getElementById("start"+z).innerHTML =hour+":"+minite;
	document.getElementById("startb"+z).style="width:95%;height:35px;background-color:green;";
	document.getElementById("startb"+z).disabled = true;
	document.getElementById("startb"+z).innerHTML="Started";
 
 }
}}}
	req4.send();

	}
	
	
	function end(z)
	{
var accu =document.getElementById("accu"+z).value;
	 app.Execute("loader2(1);");   
	var 	req4=new XMLHttpRequest();
	req4.open("GET",app.LoadText( "url" )+"addonline.php?id="+id+"&user="+User+"&device="+app.GetModel()+"&accuracy="+accu+"&type=end&pid="+z+"&token="+token,true);
		req4.onreadystatechange=function(){
if(	req4.readyState==4 && 	req4.status==200){if(	req4.responseText=="ufFygf")
{  

}else{

 if (req4.responseText.trim()==1)
 {
 app.Alert( "error please relogin" );
     app.Execute("loader2(4);");   
   app.SaveText("msg",'{"color":"red","msg":"Error"}');
 }
 else if(req4.responseText.trim()==2)
 {
  app.Alert( "User is blocked" );
       app.Execute("loader2(4);");   
   app.SaveText("msg",'{"color":"red","msg":"User is blocked"}');
 }
 else if(req4.responseText.trim()==5)
 {
       app.Execute("loader2(4);");   
   app.SaveText("msg",'{"color":"red","msg":"Already Started"}');
   app.Alert( "Already ended" )
 }
 else
 {
 app.Alert("Seccessfully Submited");
 app.Execute("loader2(4);");   
   app.SaveText("msg",'{"color":"green","msg":"Seccessfully submited"}');
  	        var today = new Date();
var mymonth =today.getMonth();

var hour = today.getHours();
var minite ="";
if(today.getMinutes().length==1)
{
minite ="0"+today.getMinutes();
}
else
{
minite =""+today.getMinutes();
}
	document.getElementById("end"+z).innerHTML =hour+":"+minite;
	document.getElementById("endb"+z).style="width:95%;height:35px;background-color:green;";
	document.getElementById("endb"+z).disabled = true;
	document.getElementById("endb"+z).innerHTML="Ended";
 
 }
}}}
	req4.send();

	}
</script>

</body>